---
title: "Airline On-Time Performance Analysis"
subtitle: "June 2018 Flight Data Analysis"
author: "Hongzhe Wang"
date: today
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 3
    code-fold: true
    code-tools: true
    embed-resources: false
---

## Executive Summary

This analysis explores the U.S. Department of Transportation's Airline On-Time Performance dataset for **June 2018**, examining over 626,000 flights across 17 major airlines. Our investigation reveals critical insights into flight delays, cancellations, and operational patterns that affect millions of passengers.

**Key Findings:**

- **Southwest Airlines** demonstrated exceptional operational efficiency with the lowest maximum delay (540 minutes)
- **Pago Pago Airport** experienced the highest average departure delays (77.6 minutes)
- **Friday** was the busiest travel day with over 108,000 flights
- **10,693 flights** were cancelled, with weather and carrier issues as primary causes

---

## 1. Maximum Departure Delays by Airline

### Analysis

Understanding which airlines experience the most severe delays helps travelers make informed booking decisions. This analysis identifies the maximum single departure delay experienced by each airline during June 2018.

```{r}
#| label: question1-load
#| message: false
#| warning: false

library(tidyverse)
library(scales)
library(plotly)
library(knitr)
library(DT)

# Read data
q1_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question1.csv")

# Clean the airline names
q1_data <- q1_data %>%
  mutate(Airline_Name = str_trim(gsub("\t", "", Airline_Name)))

# Display table
datatable(q1_data, 
          options = list(pageLength = 10, dom = 'tip'),
          caption = "Maximum Departure Delays by Airline")
```

### Visualization

```{r}
#| label: question1-viz
#| fig-width: 10
#| fig-height: 6

# Create interactive bar chart
p1 <- ggplot(q1_data, aes(x = reorder(Airline_Name, Max_Departure_Delay_Minutes), 
                          y = Max_Departure_Delay_Minutes,
                          fill = Max_Departure_Delay_Minutes,
                          text = paste("Airline:", Airline_Name, "<br>",
                                      "Max Delay:", Max_Departure_Delay_Minutes, "minutes"))) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient(low = "#2E7D32", high = "#C62828", guide = "none") +
  labs(title = "Maximum Departure Delays by Airline (June 2018)",
       subtitle = "Southwest Airlines shows the best performance with lowest maximum delay",
       x = "",
       y = "Maximum Delay (minutes)") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14),
        axis.text.y = element_text(size = 9))

ggplotly(p1, tooltip = "text")
```

### Insights

- **Southwest Airlines** leads in reliability with only 540 minutes maximum delay, nearly **3x better** than the worst performer
- **SkyWest Airlines** had the longest single delay at 1,822 minutes (over 30 hours)
- There's a **238% variation** between best and worst performers
- Low-cost carriers (Southwest, JetBlue, Alaska) generally show better delay management

---

## 2. Maximum Early Departures by Airline

### Analysis

While delays get most attention, early departures can also inconvenience passengers who arrive at the scheduled time. This metric shows how much earlier than scheduled airlines departed in their most extreme cases.

```{r}
#| label: question2-load
#| message: false
#| warning: false

q2_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question2.csv")
q2_data <- q2_data %>%
  mutate(Airline_Name = str_trim(gsub("\t", "", Airline_Name)),
         Max_Early_Departure_Minutes = abs(Max_Early_Departure_Minutes))

datatable(q2_data, 
          options = list(pageLength = 10, dom = 'tip'),
          caption = "Maximum Early Departures by Airline (in minutes)")
```

### Visualization

```{r}
#| label: question2-viz
#| fig-width: 10
#| fig-height: 6

p2 <- ggplot(q2_data, aes(x = reorder(Airline_Name, -Max_Early_Departure_Minutes), 
                          y = Max_Early_Departure_Minutes,
                          fill = Max_Early_Departure_Minutes,
                          text = paste("Airline:", Airline_Name, "<br>",
                                      "Early by:", Max_Early_Departure_Minutes, "minutes"))) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient(low = "#1976D2", high = "#E65100", guide = "none") +
  labs(title = "Maximum Early Departures by Airline (June 2018)",
       subtitle = "Allegiant Air and Southwest had the earliest departures",
       x = "",
       y = "Early Departure (minutes)") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14),
        axis.text.y = element_text(size = 9))

ggplotly(p2, tooltip = "text")
```

### Insights

- **Allegiant Air** departed 53 minutes early in its most extreme case
- **United Airlines** shows best consistency with only 21 minutes maximum early departure
- Early departures create **missed flight risks** for passengers who plan arrival around scheduled time
- The 32-minute range across airlines suggests varying operational philosophies

---

## 3. Flight Volume by Day of Week

### Analysis

Understanding weekly flight patterns helps identify peak travel days and potential capacity constraints. This analysis ranks each day by total flights operated.

```{r}
#| label: question3-load
#| message: false
#| warning: false

q3_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question3.csv")

# Reorder days properly
q3_data$Day_of_Week <- factor(q3_data$Day_of_Week, 
                              levels = c("Monday", "Tuesday", "Wednesday", 
                                       "Thursday", "Friday", "Saturday", "Sunday"))

datatable(q3_data, 
          options = list(pageLength = 10, dom = 't'),
          caption = "Flight Volume by Day of Week (Ranked)")
```

### Visualization

```{r}
#| label: question3-viz
#| fig-width: 10
#| fig-height: 6

p3 <- ggplot(q3_data, aes(x = Day_of_Week, 
                          y = Number_of_Flights,
                          fill = Day_Rank,
                          text = paste("Day:", Day_of_Week, "<br>",
                                      "Flights:", format(Number_of_Flights, big.mark=","), "<br>",
                                      "Rank:", Day_Rank))) +
  geom_col() +
  geom_text(aes(label = format(Number_of_Flights, big.mark=",")), 
            vjust = -0.5, size = 3.5) +
  scale_fill_gradient(low = "#4CAF50", high = "#FFC107") +
  labs(title = "Daily Flight Volume Distribution (June 2018)",
       subtitle = "Friday leads with 108K flights; Sunday sees lowest traffic",
       x = "Day of Week",
       y = "Number of Flights",
       fill = "Rank") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14),
        axis.text.x = element_text(angle = 45, hjust = 1))

ggplotly(p3, tooltip = "text")
```

### Insights

- **Friday** dominates with 108,359 flights, marking peak business and leisure travel
- **Weekend pattern**: Saturday drops to 91K flights, Sunday lowest at 83K
- **30% volume difference** between busiest (Friday) and quietest (Sunday) days
- Mid-week days (Tue-Thu) show consistent volume around 85-87K flights
- Pattern reflects **business travel peaks** at week's end and **leisure travel** on Fridays

---

## 4. Airport with Highest Average Departure Delay

### Analysis

Identifying airports with chronic delay problems helps travelers plan connections and airlines optimize operations.

```{r}
#| label: question4-load
#| message: false
#| warning: false

q4_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question4.csv")

kable(q4_data, 
      caption = "Airport with Highest Average Departure Delay",
      col.names = c("Airport Name", "Airport Code", "Avg Delay (minutes)"),
      digits = 2)
```

### Context & Insights

**Pago Pago International Airport (PPG)** in American Samoa shows an average departure delay of **77.6 minutes** - more than an hour beyond scheduled departure times.

**Why this matters:**

- **Remote location**: PPG serves as a critical Pacific hub with limited infrastructure
- **Weather patterns**: Tropical weather can cause significant operational challenges  
- **Limited alternatives**: Few rerouting options when delays occur
- **Sample size consideration**: Fewer flights mean each delay has larger statistical impact

**For travelers:**
- Always book longer connections through PPG
- Consider travel insurance for PPG itineraries
- Monitor weather forecasts before departure

---

## 5. Airlines' Worst-Performing Airports

### Analysis

Each airline has airports where operational challenges create above-average delays. Understanding these pain points reveals network vulnerabilities.

```{r}
#| label: question5-load
#| message: false
#| warning: false

q5_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question5.csv")
q5_data <- q5_data %>%
  mutate(Airline_Name = str_trim(gsub("\t", "", Airline_Name)))

datatable(q5_data, 
          options = list(pageLength = 17, dom = 'tip'),
          caption = "Each Airline's Highest Average Delay Airport",
          colnames = c("Airline", "Airport", "Avg Delay (min)"))
```

### Visualization

```{r}
#| label: question5-viz
#| fig-width: 11
#| fig-height: 7

p5 <- ggplot(q5_data, aes(x = reorder(Airline_Name, Highest_Avg_Departure_Delay), 
                          y = Highest_Avg_Departure_Delay,
                          fill = Highest_Avg_Departure_Delay,
                          text = paste("Airline:", Airline_Name, "<br>",
                                      "Airport:", Airport_Name, "<br>",
                                      "Avg Delay:", round(Highest_Avg_Departure_Delay, 1), "min"))) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient2(low = "#4CAF50", mid = "#FFC107", high = "#D32F2F", 
                       midpoint = 60, guide = "none") +
  geom_hline(yintercept = 60, linetype = "dashed", color = "red", alpha = 0.5) +
  labs(title = "Each Airline's Most Problematic Airport (June 2018)",
       subtitle = "Endeavor Air at Mobile shows worst performance (120 min avg delay)",
       x = "",
       y = "Average Departure Delay (minutes)") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 13),
        axis.text.y = element_text(size = 8))

ggplotly(p5, tooltip = "text")
```

### Key Insights

- **Endeavor Air at Mobile, AL**: Worst performer at 120 minutes average delay
- **Mesa Airlines at Syracuse, NY**: Second worst at 105 minutes
- **Regional airports** dominate the problem list, suggesting infrastructure constraints
- **Southwest at Greer, SC**: Best of the worst at only 28 minutes
- **8x variation** between best and worst airline-airport combinations

**Pattern analysis:**
- Smaller regional airports face greater operational challenges
- Weather-prone locations (Syracuse snow, Mobile storms) appear frequently
- Limited staffing and equipment at regional airports compound delays

---

## 6. Flight Cancellations Analysis

### 6a. Overall Cancellation Count

```{r}
#| label: question6a-load
#| message: false
#| warning: false

q6a_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question6a.csv")

kable(q6a_data, 
      caption = "Total Cancelled Flights in June 2018",
      col.names = "Cancelled Flights",
      format.args = list(big.mark = ","))
```

**Impact Assessment:**

- **10,693 cancelled flights** out of approximately 626,217 total flights
- Represents **~1.7% cancellation rate**
- Affects an estimated **1-2 million passengers** (assuming 100-200 passengers per flight)

### 6b. Cancellation Reasons by Airport

```{r}
#| label: question6b-load
#| message: false
#| warning: false

q6b_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question6b.csv")

# Show top 20 airports by cancellation count
q6b_top <- q6b_data %>%
  arrange(desc(Cancellation_Count)) %>%
  head(20)

datatable(q6b_top, 
          options = list(pageLength = 10, dom = 'tip'),
          caption = "Top 20 Airports by Cancellation Count",
          colnames = c("Airport", "Primary Reason", "Count"))
```

### Visualization: Cancellation Reasons

```{r}
#| label: question6b-viz1
#| fig-width: 10
#| fig-height: 7

p6b <- ggplot(q6b_top, aes(x = reorder(Airport_Name, Cancellation_Count), 
                           y = Cancellation_Count,
                           fill = Most_Frequent_Reason,
                           text = paste("Airport:", Airport_Name, "<br>",
                                       "Reason:", Most_Frequent_Reason, "<br>",
                                       "Cancellations:", Cancellation_Count))) +
  geom_col() +
  coord_flip() +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Top 20 Airports by Flight Cancellations (June 2018)",
       subtitle = "Dallas/Fort Worth leads with 1,108 carrier-related cancellations",
       x = "",
       y = "Number of Cancellations",
       fill = "Primary Reason") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 13),
        axis.text.y = element_text(size = 9))

ggplotly(p6b, tooltip = "text")
```

### Cancellation Reason Distribution

```{r}
#| label: question6b-viz2
#| fig-width: 8
#| fig-height: 6

reason_summary <- q6b_data %>%
  group_by(Most_Frequent_Reason) %>%
  summarize(Total = sum(Cancellation_Count)) %>%
  arrange(desc(Total)) %>%
  mutate(Percentage = round(Total/sum(Total)*100, 1),
         Label = paste0(Most_Frequent_Reason, "\n", 
                       format(Total, big.mark=","), " (", 
                       Percentage, "%)"))

# Use a bar chart instead of pie chart for better plotly compatibility
p6b2 <- ggplot(reason_summary, aes(x = reorder(Most_Frequent_Reason, Total), 
                                   y = Total,
                                   fill = Most_Frequent_Reason,
                                   text = paste("Reason:", Most_Frequent_Reason, "<br>",
                                               "Cancellations:", format(Total, big.mark=","), "<br>",
                                               "Percentage:", Percentage, "%"))) +
  geom_col() +
  geom_text(aes(label = paste0(format(Total, big.mark=","), "\n(", Percentage, "%)")), 
            hjust = -0.1, size = 4) +
  coord_flip() +
  scale_fill_brewer(palette = "Set3") +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(title = "Distribution of Cancellation Reasons",
       subtitle = "Carrier issues are the dominant cause of flight cancellations",
       x = "",
       y = "Number of Cancellations") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14),
        legend.position = "none")

# Display as static ggplot (pie charts don't work well with plotly)
p6b2
```

### Key Insights

- **Dallas/Fort Worth (DFW)** experienced 1,108 cancellations - all carrier-related
- **Carrier issues** dominate as cancellation cause, suggesting operational/mechanical problems
- **Baltimore** had 116 National Air System cancellations (air traffic control, airport operations)
- **Weather** impacts certain locations more (e.g., Midwest, Northeast airports)

**Cancellation categories:**

1. **Carrier**: Mechanical issues, crew problems, baggage handling
2. **Weather**: Storms, fog, snow, wind
3. **National Air System**: ATC delays, airport operations, security
4. **Security**: Relatively rare in this dataset

---

## 7. Rolling Average Flight Volume

### Analysis

This metric shows the 3-day rolling average of flights, helping identify trends and patterns throughout the month that single-day data might obscure.

```{r}
#| label: question7-load
#| message: false
#| warning: false

q7_data <- read_csv("miniproj_Hongzhe_Wang_hw530_question7.csv")

# Clean the data - remove the duplicate header row and convert to proper types
q7_data <- q7_data %>%
  filter(FlightDate != "FlightDate") %>%
  mutate(FlightDate = as.Date(FlightDate),
         Avg_Flights_Preceding_3_Days = as.numeric(Avg_Flights_Preceding_3_Days))

datatable(q7_data, 
          options = list(pageLength = 10, dom = 'tip'),
          caption = "3-Day Rolling Average of Daily Flights",
          colnames = c("Date", "3-Day Avg Flights"))
```

### Visualization

```{r}
#| label: question7-viz
#| fig-width: 11
#| fig-height: 6

p7 <- ggplot(q7_data, aes(x = FlightDate, 
                          y = Avg_Flights_Preceding_3_Days,
                          text = paste("Date:", format(FlightDate, "%B %d, %Y"), "<br>",
                                      "3-Day Avg:", format(round(Avg_Flights_Preceding_3_Days), big.mark=",")))) +
  geom_line(color = "#1976D2", size = 1) +
  geom_point(color = "#1976D2", size = 2) +
  geom_smooth(method = "loess", se = TRUE, color = "#D32F2F", linetype = "dashed") +
  scale_y_continuous(labels = comma) +
  scale_x_date(date_breaks = "2 days", date_labels = "%b %d") +
  labs(title = "3-Day Rolling Average of Daily Flights (June 2018)",
       subtitle = "Flight volume shows weekly cyclical pattern with weekend dips",
       x = "Date",
       y = "Average Number of Flights (3-Day Window)") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 13),
        axis.text.x = element_text(angle = 45, hjust = 1))

ggplotly(p7, tooltip = "text")
```

### Insights

- **Clear weekly pattern**: Peaks on Fridays (21,000+ flights), drops on Sundays (18,000-19,000 flights)
- **Stable mid-month**: June 13-23 shows consistent high volume around 21,500 flights
- **Gradual increase**: Volume trends upward through the month toward peak summer travel season
- **Rolling average smooths** daily volatility, revealing underlying patterns

**Operational implications:**

- Airlines can **anticipate capacity needs** based on day-of-week patterns
- **Staffing optimization**: Higher crews needed Thu-Sat, reduced Sun-Mon
- **Price dynamics**: Premium pricing justified on high-demand days (Thu-Fri)

---

## Overall Conclusions

### Key Takeaways

1. **Airline Reliability Varies Significantly**
   - Southwest, Alaska, and JetBlue demonstrate superior operational control
   - Regional carriers face greater delay challenges
   - 3x difference between best and worst performers in maximum delays

2. **Geographic Patterns Matter**
   - Remote locations (Pago Pago) and regional airports face structural challenges
   - Weather-prone regions show higher cancellation rates
   - Hub airports generally manage delays better than spoke airports

3. **Temporal Patterns Are Predictable**
   - Friday dominates with 30% more flights than Sunday
   - Weekly cycles are consistent and actionable for planning
   - Mid-month stability suggests successful capacity management

4. **Cancellation Strategy Varies**
   - Carrier-related issues dominate (mechanical, crew)
   - Weather and NAS factors show geographic concentration
   - 1.7% overall cancellation rate affects millions of passengers

### Recommendations

**For Travelers:**

- Choose Southwest, Alaska, or JetBlue for better reliability
- Avoid tight connections at regional airports
- Book Friday flights early; prices premium but availability critical
- Allow extra time at historically delayed airports (PPG, DFW)

**For Airlines:**

- Invest in regional airport infrastructure and staffing
- Focus maintenance resources on preventing carrier cancellations
- Optimize crew scheduling for Friday peak demand
- Develop weather contingency plans for vulnerable airports

**For Industry:**

- Address National Air System constraints at major hubs
- Improve regional airport capabilities
- Enhance passenger communication during disruptions
- Consider demand management on peak days

---

## Data & Methodology

**Dataset**: U.S. DOT Airline On-Time Performance  
**Period**: June 2018  
**Total Flights**: ~626,217  
**Airlines Analyzed**: 17 major U.S. carriers  
**Airports**: 296 departure airports tracked

**Tools Used:**

- **Database**: MySQL (AWS RDS)
- **Analysis**: R with tidyverse, ggplot2
- **Visualization**: Plotly for interactivity
- **Publishing**: Quarto + GitHub Pages

**SQL Queries** performed all data aggregation and filtering. R was used exclusively for visualization and presentation.

---

## Appendix: Technical Notes

### Data Quality Considerations

- Early departures recorded as negative delay values
- Cancellations excluded from delay calculations
- Rolling averages use preceding 3 days (first date shows NA)
- Airport names standardized from FAA codes

### Query Approach

Each question required different SQL techniques:

- **Q1-2**: Simple GROUP BY with MAX aggregation
- **Q3**: Ranking with window functions
- **Q4-5**: Multiple joins between fact and dimension tables
- **Q6**: Filtering for cancelled flights with join on cancellation codes
- **Q7**: Window functions for rolling calculations

### Visualization Philosophy

All charts prioritize:

- **Clarity**: Clean design without chart junk
- **Interactivity**: Hover details for deeper exploration  
- **Context**: Annotations and subtitles explain significance
- **Color**: Meaningful gradients showing severity/rank

---

*Analysis completed as part of Database Management Systems coursework*  
*For questions or collaboration: hw530@georgetown.edu*
